<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<title>Heroclix Map Viewer</title>
<style type="text/css">
#mapTitle {
	font-family: Arial, Helvetica, sans-serif;
	font-size: xx-large;
	font-weight: bold;
	background-color: #E3F0FB;
	text-align: center;
}
.mapInfo {
	font-family: Arial, Helvetica, sans-serif;
	font-size: medium;
	font-weight: bold;
	background-color: #E3F0FB;
	text-align: center;
}
</style>
</head>

<body>
<div id="mapTitle">
  <button style="float: left" onclick="previousMap()">Previous</button>
  <span id="mapName"></span>
  <button style="float: right" onclick="nextMap()">Next</button>
</div>
<div id="mapSet" class="mapInfo"></div>
<div id="mapType" class="mapInfo"></div>
<canvas id="MapCanvas">
</canvas>

<script type="text/javascript" src="js/edge.js"></script>
<script type="text/javascript" src="js/tile.js"></script>
<script type="text/javascript" src="js/wall.js"></script>
<script type="text/javascript" src="js/map.js"></script>

<script>

function getJson(location, callback) {
	var request = new XMLHttpRequest();
	request.overrideMimeType("application/json");
    request.open('GET', location, true);
    request.onreadystatechange = function () {
    	if (request.readyState == 4 && request.status == "200") {
    		callback(request.responseText);
    	}
    };
    request.send(null);  
}

var mapScale = 0;

function loadMap(location) {
  getJson(location, function(json) {
		var jsonMap;
		try {
			jsonMap = JSON.parse(json);
		} catch (e) {
			alert(e);
		}
    var map = new Map(jsonMap);
    var c = document.getElementById("MapCanvas");
    var ctx = c.getContext("2d");
    ctx.save()
    var windowWidth = window.innerWidth - 20;
    var windowHeight = window.innerHeight - 100;
    if (mapScale <= 0) {
      c.width = windowWidth;
      c.height = windowHeight;
      var sx = c.width / (map.width * TILE_SIZE);
      var sy = c.height / (map.height * TILE_SIZE);
      var scale = sx < sy ? sx : sy;
      ctx.scale(scale, scale);
      ctx.translate((windowWidth / scale - map.width * TILE_SIZE) / 2, 0);
    } else if (mapScale >= 1) {
      c.width = map.width * TILE_SIZE;
      c.height = map.height * TILE_SIZE;
    } else {
      c.width = windowWidth;
      c.height = map.height * TILE_SIZE * mapScale;
      ctx.scale(mapScale, mapScale);
      ctx.translate((windowWidth - map.width * TILE_SIZE * mapScale), 0);
    }
    map.draw(ctx);
    ctx.restore();
    document.getElementById("mapName").innerHTML = jsonMap.name;
    document.getElementById("mapSet").innerHTML = jsonMap.set;
    var mapType;
    if (jsonMap.type == "indoor") {
      mapType = "Indoor";
    } else if (jsonMap.type == "outdoor") {
      mapType = "Outdoor";
    } else if (jsonMap.type == "indoorOutdoor") {
      mapType = "Indoor/Outdoor";
    }
    document.getElementById("mapType").innerHTML = mapType;
	});
}

var MAPS = [
  // Premium Maps
  "maps/premium/cargo_ship.json",
  "maps/premium/convention_center_plaza.json",
  "maps/premium/gaming_convention_hall.json",
  "maps/premium/parking_garage.json",
  "maps/premium/warehouse_5651.json",
  "maps/premium/wizkids_office_hq.json",

  // Joker's Wild
  "maps/jw/ace_chemicals.json",
  "maps/jw/ace_street.json",

  // Superior Foes of Spider-Man
  "maps/sfsm/bank_heist.json",
  "maps/sfsm/friendly_neighborhood.json",

  // Civil War
  "maps/cwsop/chemical_plant.json",
  "maps/cwsop/final_battle_new_york.json",
  "maps/cwsop/prison_42.json",
  "maps/cwsop/stamford.json",

  // Uncanny X-Men
  "maps/uxm/jean_grey_school_for_higher_learning.json",
  "maps/uxm/jean_grey_school_for_higher_learning_grounds.json",
  "maps/uxm/manhattan_bridge.json",
  "maps/uxm/morlock_tunnels.json",

  // TMNT
  "maps/tmnt/sewers.json",
  "maps/tmnt/technodrome.json",

  // Captain America: Civil War
  "maps/cacw/avengers_hq_upstate_indoor.json",
  "maps/cacw/avengers_hq_upstate_outdoor.json",

  // World's Finest
  "maps/wf/danny_the_street.json",
  "maps/wf/united_nations_conference.json",

  // Superman/Wonder Woman
  "maps/smww/mount_olympus.json",
  "maps/smww/the_daily_planet.json",

  // NF:AoS
  "maps/nfaos/hydra_island.json",
  "maps/nfaos/nick_furys_safehouse.json",

  // Age of Ultron
  "maps/aou/hank_pyms_lab.json",
  "maps/aou/new_timbetpal.json",
  "maps/aou/new_york_city.json",
  "maps/aou/thebes_egypt.json",

  // Avengers Assemble
  "maps/avas/arcades_arena.json",
  "maps/avas/avengers_compound.json",

  // Avengers: Age of Ultron
  "maps/aaou/avengers_tower.json",
  "maps/aaou/struckers_fortress.json",

  // Justice League Trinity War
  "maps/jltw/hall_of_doom.json",
  "maps/jltw/hall_of_doom_slaughter_swamp.json",
  "maps/jltw/house_of_mystery.json",
  "maps/jltw/atlantis.json",

  // The Flash
  "maps/fl/central_city.json",
  "maps/fl/central_city_park.json",
  "maps/fl/keystone_city.json",
  "maps/fl/the_flash_museum.json",

  // Guardians of the Galaxy
  "maps/gotg/attilan_blue_area_of_the_moon.json",
  "maps/gotg/attilan_north_atlantic_ocean.json",
  "maps/gotg/star_lords_ship.json",
  "maps/gotg/titan.json",

  // Guardians of the Galaxy Movie
  "maps/gotgm/nova_corps_headquarters.json",
  "maps/gotgm/the_kyln.json",

  // War of Light
  "maps/wol/black_mercy_garden.json",
  "maps/wol/coast_city.json",
  "maps/wol/korugar.json",
  "maps/wol/nok.json",
  "maps/wol/oa_central_battery_plaza.json",
  "maps/wol/oa_the_big_w.json",
  "maps/wol/okaara_temple.json",
  "maps/wol/odym.json",
  "maps/wol/qward_armory_and_forge.json",
  "maps/wol/ranx.json",
  "maps/wol/ryut.json",
  "maps/wol/space.json",
  "maps/wol/ysamault.json",
  "maps/wol/zamaron.json",

  // Days of Future Past
  "maps/dofp/baxter_building_sentinel_hq.json",
  "maps/dofp/south_bronx_mutant_internment_center.json",

  // Deadpool
  "maps/dp/deadpools_house.json",
  "maps/dp/hellhouse.json",
  "maps/dp/the_mall.json",
  "maps/dp/thunderbolts_submarine.json",

  // Captain America: The Winter Soldier
  "maps/catws/helicarrier.json",
  "maps/catws/triskelion_helibay.json",

  // Avengers vs. X-Men
  "maps/avx/avengers_tower.json",
  "maps/avx/kun_lun.json",
  "maps/avx/limbo.json",
  "maps/avx/savage_land.json",
  "maps/avx/surface_of_the_moon.json",
  "maps/avx/utopia.json",
  "maps/avx/utopia_east.json",
  "maps/avx/utopia_west.json",
  "maps/avx/verkhoyansk_mountains.json",
  "maps/avx/wundagore_mountain.json",
];

var currentMap = MAPS.length - 1;
loadMap(MAPS[currentMap]);

document.onkeydown = handleKeyDown;

function handleKeyDown(e) {
	var KEY_LEFT = '37';
	var KEY_RIGHT = '39';
  e = e || window.event;
  if (e.keyCode == KEY_LEFT) {
    previousMap();
  } else if (e.keyCode == KEY_RIGHT) {
    nextMap();
  }
}

function previousMap() {
  --currentMap;
  if (currentMap < 0) {
    currentMap = MAPS.length - 1;
  }
	loadMap(MAPS[currentMap]);
}

function nextMap() {
  ++currentMap;
  if (currentMap >= MAPS.length) {
    currentMap = 0;
  }
	loadMap(MAPS[currentMap]);
}

</script>

</body>
</html>
